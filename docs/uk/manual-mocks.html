<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Manual Mocks · Jest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Manual Mocks · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="Manual mocks are used to stub out functionality with mock data. For example, instead of accessing a remote resource like a website or a database, you might want to create a manual mock that allows you to use fake data. This ensures your tests will be fast and not flaky."/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><link rel="alternate" type="application/atom+xml" href="https://facebook.github.io/blog/atom.xml" title="Jest Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://facebook.github.io/blog/feed.xml" title="Jest Blog RSS Feed"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img class="logo" src="/jest/img/jest.svg"/><h2 class="headerTitle">Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/uk/getting-started.html" target="_self">Документація</a></li><li><a href="/jest/docs/uk/api.html" target="_self">API</a></li><li><a href="/jest/uk/help.html" target="_self">Допомога</a></li><li><a href="/jest/blog" target="_self">Блог</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>Українська</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/en">English</a></li><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ro">Română</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/zh-Hans">简体中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/uk/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/using-matchers.html">Using Matchers</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/asynchronous.html">Testing Asynchronous Code</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/setup-teardown.html">Setup and Teardown</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/mock-functions.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/more-resources.html">More Resources</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/uk/api.html">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/expect.html">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/mock-function-api.html">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/jest-object.html">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/configuration.html">Configuring Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/cli.html">Jest CLI Options</a></li></ul></div><div class="navGroup navGroupActive"><h3>Framework Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/uk/tutorial-react.html">Testing React Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/tutorial-react-native.html">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/testing-frameworks.html">Testing Web Frameworks</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/uk/snapshot-testing.html">Тестування з допомогою знімків</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/tutorial-async.html">An Async Example</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/timer-mocks.html">Timer Mocks</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/uk/manual-mocks.html">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/webpack.html">Using with webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/migration-guide.html">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/uk/troubleshooting.html">Troubleshooting</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Manual Mocks</h1></header><article><div><span><p>Manual mocks are used to stub out functionality with mock data. For example, instead of accessing a remote resource like a website or a database, you might want to create a manual mock that allows you to use fake data. This ensures your tests will be fast and not flaky.</p>
<p>Manual mocks are defined by writing a module in a <code>__mocks__/</code> subdirectory immediately adjacent to the module. For example, to mock a module called <code>user</code> in the <code>models</code> directory, create a file called <code>user.js</code> and put it in the <code>models/__mocks__</code> directory. Note that the <code>__mocks__</code> folder is case-sensitive, so naming the directory <code>__MOCKS__</code> will break on some systems. If the module you are mocking is a node module (eg: <code>fs</code>), the mock should be placed in the <code>__mocks__</code> directory adjacent to <code>node_modules</code> (unless you configured <a href="/jest/docs/uk/configuration.html#roots-array-string"><code>roots</code></a> to point to a folder other than the project root). Eg:</p>
<pre><code class="language-bash">.
├── config
├── __mocks__
│   └── fs.js
├── models
│   ├── __mocks__
│   │   └── user.js
│   └── user.js
├── node_modules
└── views
</code></pre>
<p>When a manual mock exists for a given module, Jest's module system will use that module when explicitly calling <code>jest.mock('moduleName')</code>. However, manual mocks will take precedence over node modules even if <code>jest.mock('moduleName')</code> is not called. To opt out of this behavior you will need to explicitly call <code>jest.unmock('moduleName')</code> in tests that should use the actual module implementation.</p>
<p>Here's a contrived example where we have a module that provides a summary of all the files in a given directory.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// FileSummarizer.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">summarizeFilesInDirectorySync</span>(<span class="hljs-params">directory</span>) </span>{
  <span class="hljs-keyword">return</span> fs.readdirSync(directory).map(<span class="hljs-function"><span class="hljs-params">fileName</span> =&gt;</span> ({
    directory,
    fileName,
  }));
}

exports.summarizeFilesInDirectorySync = summarizeFilesInDirectorySync;
</code></pre>
<p>Since we'd like our tests to avoid actually hitting the disk (that's pretty slow and fragile), we create a manual mock for the <code>fs</code> module by extending an automatic mock. Our manual mock will implement custom versions of the <code>fs</code> APIs that we can build on for our tests:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// __mocks__/fs.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> fs = jest.genMockFromModule(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// This is a custom function that our tests can use during setup to specify</span>
<span class="hljs-comment">// what the files on the "mock" filesystem should look like when any of the</span>
<span class="hljs-comment">// `fs` APIs are used.</span>
<span class="hljs-keyword">let</span> mockFiles = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__setMockFiles</span>(<span class="hljs-params">newMockFiles</span>) </span>{
  mockFiles = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">in</span> newMockFiles) {
    <span class="hljs-keyword">const</span> dir = path.dirname(file);

    <span class="hljs-keyword">if</span> (!mockFiles[dir]) {
      mockFiles[dir] = [];
    }
    mockFiles[dir].push(path.basename(file));
  }
}

<span class="hljs-comment">// A custom version of `readdirSync` that reads from the special mocked out</span>
<span class="hljs-comment">// file list set via __setMockFiles</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readdirSync</span>(<span class="hljs-params">directoryPath</span>) </span>{
  <span class="hljs-keyword">return</span> mockFiles[directoryPath] || [];
}

fs.__setMockFiles = __setMockFiles;
fs.readdirSync = readdirSync;

<span class="hljs-built_in">module</span>.exports = fs;
</code></pre>
<p>Тепер ми пишемо наш тест:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/FileSummarizer-test.js</span>
<span class="hljs-meta">'use strict'</span>;

jest.mock(<span class="hljs-string">'fs'</span>);

describe(<span class="hljs-string">'listFilesInDirectorySync'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> MOCK_FILE_INFO = {
    <span class="hljs-string">'/path/to/file1.js'</span>: <span class="hljs-string">'console.log("file1 contents");'</span>,
    <span class="hljs-string">'/path/to/file2.txt'</span>: <span class="hljs-string">'file2 contents'</span>,
  };

  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-comment">// Set up some mocked out file info before each test</span>
    <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).__setMockFiles(MOCK_FILE_INFO);
  });

  test(<span class="hljs-string">'includes all files in the directory in the summary'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> FileSummarizer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../FileSummarizer'</span>);
    <span class="hljs-keyword">const</span> fileSummary = FileSummarizer.summarizeFilesInDirectorySync(
      <span class="hljs-string">'/path/to'</span>
    );

    expect(fileSummary.length).toBe(<span class="hljs-number">2</span>);
  });
});
</code></pre>
<p>The example mock shown here uses <a href="/jest/docs/uk/jest-object.html#jestgenmockfrommodulemodulename"><code>jest.genMockFromModule</code></a> to generate an automatic mock, and overrides its default behavior. This is the recommended approach, but is completely optional. If you do not want to use the automatic mock at all, you can simply export your own functions from the mock file. One downside to fully manual mocks is that they're manual – meaning you have to manually update them any time the module they are mocking changes. Because of this, it's best to use or extend the automatic mock when it works for your needs.</p>
<p>To ensure that a manual mock and its real implementation stay in sync, it might be useful to require the real module using <code>require.requireActual(moduleName)</code> in your manual mock and amending it with mock functions before exporting it.</p>
<p>Код для цього прикладу доступий в <a href="https://github.com/facebook/jest/tree/master/examples/manual_mocks">examples/manual_mocks</a>.</p>
<h3><a class="anchor" name="es"></a>Використання з ES імпортом модулів <a class="hash-link" href="#es">#</a></h3>
<p>If you're using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">ES module imports</a> then you'll normally be inclined to put your <code>import</code> statements at the top of the test file. But often you need to instruct Jest to use a mock before modules use it. For this reason, Jest will automatically hoist <code>jest.mock</code> calls to the top of the module (before any imports). Щоб дізнатися більше про це і побачити в дії, загляньте в <a href="https://github.com/kentcdodds/how-jest-mocking-works"> цей репозиторій</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="timer-mocks.html">← Timer Mocks</a><a class="docs-next button" href="webpack.html">Using with webpack →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest/" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/uk/getting-started.html">Getting Started</a><a href="/jest/docs/uk/snapshot-testing.html">Guides</a><a href="/jest/docs/uk/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/uk/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>