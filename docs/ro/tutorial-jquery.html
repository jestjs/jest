<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>DOM Manipulation · Jest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="DOM Manipulation · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="O altă clasă de funcţii, care este adesea considerată dificil de testat este codul care manipulează direct DOM. Să vedem cum putem testa următorul fragment de cod jQuery care ascultă un eveniment click, preia niște date asincron şi construiește conţinutul unui element span."/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><link rel="alternate" type="application/atom+xml" href="https://facebook.github.io/blog/atom.xml" title="Jest Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://facebook.github.io/blog/feed.xml" title="Jest Blog RSS Feed"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img class="logo" src="/jest/img/jest.svg"/><h2 class="headerTitle">Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/ro/getting-started.html" target="_self">Documentație</a></li><li><a href="/jest/docs/ro/api.html" target="_self">API</a></li><li><a href="/jest/ro/help.html" target="_self">Ajutor</a></li><li><a href="/jest/blog" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>Română</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/en">English</a></li><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/uk">Українська</a></li><li><a href="/jest/zh-Hans">简体中文</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>DOM Manipulation</h1></header><article><div><span><p>O altă clasă de funcţii, care este adesea considerată dificil de testat este codul care manipulează direct DOM. Să vedem cum putem testa următorul fragment de cod jQuery care ascultă un eveniment click, preia niște date asincron şi construiește conţinutul unui element span.</p>
<pre><code class="language-javascript"><span class="hljs-comment">// displayUser.js</span>
<span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
<span class="hljs-keyword">const</span> fetchCurrentUser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./fetchCurrentUser.js'</span>);

$(<span class="hljs-string">'#button'</span>).click(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  fetchCurrentUser(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> loggedText = <span class="hljs-string">'Logged '</span> + (user.loggedIn ? <span class="hljs-string">'In'</span> : <span class="hljs-string">'Out'</span>);
    $(<span class="hljs-string">'#username'</span>).text(user.fullName + <span class="hljs-string">' - '</span> + loggedText);
  });
});
</code></pre>
<p>Din nou, vom crea un fișier de test în directorul <code>__tests__ /</code>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// __tests__/displayUser-test.js</span>
<span class="hljs-meta">'use strict'</span>;

jest.mock(<span class="hljs-string">'../fetchCurrentUser'</span>);

test(<span class="hljs-string">'displays a user after a click'</span>, () =&gt; {
  <span class="hljs-comment">// Set up our document body</span>
  <span class="hljs-built_in">document</span>.body.innerHTML =
    <span class="hljs-string">'&lt;div&gt;'</span> +
    <span class="hljs-string">'  &lt;span id="username" /&gt;'</span> +
    <span class="hljs-string">'  &lt;button id="button" /&gt;'</span> +
    <span class="hljs-string">'&lt;/div&gt;'</span>;

  <span class="hljs-comment">// This module has a side-effect</span>
  <span class="hljs-built_in">require</span>(<span class="hljs-string">'../displayUser'</span>);

  <span class="hljs-keyword">const</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
  <span class="hljs-keyword">const</span> fetchCurrentUser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../fetchCurrentUser'</span>);

  <span class="hljs-comment">// Tell the fetchCurrentUser mock function to automatically invoke</span>
  <span class="hljs-comment">// its callback with some data</span>
  fetchCurrentUser.mockImplementation(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span>  {
    cb({
      <span class="hljs-attr">fullName</span>: <span class="hljs-string">'Johnny Cash'</span>,
      <span class="hljs-attr">loggedIn</span>: <span class="hljs-literal">true</span>,
    });
  });

  <span class="hljs-comment">// Use jquery to emulate a click on our button</span>
  $(<span class="hljs-string">'#button'</span>).click();

  <span class="hljs-comment">// Assert that the fetchCurrentUser function was called, and that the</span>
  <span class="hljs-comment">// #username span's inner text was updated as we'd expect it to.</span>
  expect(fetchCurrentUser).toBeCalled();
  expect($(<span class="hljs-string">'#username'</span>).text()).toEqual(<span class="hljs-string">'Johnny Cash - Logged In'</span>);
});

</code></pre>
<p>Funcţia testată ascultă evenimente pe elementul DOM <code>#button</code>, aşadar avem nevoie să configurăm corect DOM-ul pentru test. Jest este livrat cu <code>jsdom</code>, care simuleaza un mediu DOM, similar cu un browser. Acest lucru înseamnă că fiecare API DOM apelat poate fi observat la fel cum ar fi observat într-un browser!</p>
<p>Mock-uim <code>fetchCurrentUser.js</code> astfel încât testul nostru nu accesează cu adevărat reţeaua, dar în schimb se rezolvă local cu date fictive. Acest lucru asigură că testul nostru se finalizează în milisecunde, în loc de secunde şi garantează o iterație rapidă de teste unitare.</p>
<p>Codul pentru acest exemplu este disponibil la <a href="https://github.com/facebook/jest/tree/master/examples/jquery"> exemple/jquery</a>.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest/" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/ro/getting-started.html">Getting Started</a><a href="/jest/docs/ro/snapshot-testing.html">Guides</a><a href="/jest/docs/ro/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/ro/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>