<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Jest 14.0: React Tree Snapshot Testing · Jest</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Jest 14.0: React Tree Snapshot Testing · Jest"><meta property="og:type" content="website"><meta property="og:url" content="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html"><meta property="og:image" content="https://facebook.github.io/jest/img/opengraph.png"><meta property="og:description" content="One of Jest&#x27;s philosophies is to provide an integrated “zero-configuration” experience. We want to make it as frictionless as possible to write good tests that are useful. We observed that when engineers are provided with ready-to-use tools, they end up writing more tests, which in turn results in stable and healthy code bases."><link rel="shortcut icon" href="/jest/img/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="stylesheet" href="/jest/css/jest.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><div class="navSlideout"><i class="menuExpand"><span></span><span></span><span></span></i></div><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/tutorial.html#content" class="">Docs</a></li><li><a href="/jest/support.html#content" class="">Support</a></li><li><a href="/jest/blog/#content" class="active">Blog</a></li><li><a href="https://github.com/facebook/jest" class="">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input id="search_input_react" type="text" placeholder="Search"></li></ul></nav><script>
          var triggers = document.getElementsByClassName('menuExpand');
          var navs = document.getElementsByClassName('navSlideout');
          for (var i=0; i < triggers.length; i++) {
            triggers[i].onclick = function() {
              for (var j=0; j < navs.length; j++) {
                navs[j].classList.toggle('navSlideoutActive');
                navs[j].nextSibling.classList.toggle('slidingNavActive');
              }
            };
          }
        </script></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><a href="/jest/blog/">Blog</a><i>›</i><span>Recent Posts</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Recent Posts</h3><ul><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/blog/2016/07/27/jest-14.html">Jest 14.0: React Tree Snapshot Testing</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/06/22/jest-13.html">Jest 13.0: Flow, Property Testing and REPL</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/04/12/jest-11.html">Jest 11.0</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/03/11/javascript-unit-testing-performance.html">JavaScript Unit Testing Performance</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer documentContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><p class="post-authorName"><a href="http://twitter.com/cpojer" target="_blank">Christoph Pojer</a></p><h1><a href="/jest/blog/2016/07/27/jest-14.html">Jest 14.0: React Tree Snapshot Testing</a></h1><p class="post-meta">July 27, 2016</p></header><div><p>One of Jest&#x27;s philosophies is to provide an integrated “zero-configuration” experience. We want to make it as frictionless as possible to write good tests that are useful. We observed that when engineers are provided with ready-to-use tools, they end up writing more tests, which in turn results in stable and healthy code bases.</p><div><!--truncate-->

</div><p>One of the big open questions was how to write React tests efficiently. There are plenty of tools such as <a href="https://facebook.github.io/react/docs/test-utils.html" target="_blank">ReactTestUtils</a> and <a href="http://airbnb.io/enzyme/" target="_blank">enzyme</a>. Both of these tools are great and are actively being used. However engineers frequently told us that they spend more time writing a test than the component itself. As a result many people stopped writing tests altogether which eventually led to instabilities. Engineers told us all they wanted was to make sure their components don&#x27;t change unexpectedly.</p><p>Together with the React team we created a new test renderer for React and added snapshot testing to Jest. Consider this <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/Link.react-test.js" target="_blank">example test</a> for a simple <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Link.react.js" target="_blank">Link component</a>:</p><pre class="prism language-javascript">
<span class="token keyword">import</span> renderer <span class="token keyword">from</span> <span class="token string">&#x27;react/lib/ReactTestRenderer&#x27;</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;Link renders correctly&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.facebook.com&quot;</span><span class="token operator">&gt;</span>Facebook<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>The first time this test is run, Jest creates a <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/__snapshots__/Link.react-test.js.snap" target="_blank">snapshot file</a> that looks like this:</p><pre class="prism language-javascript">
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`Link changes the class when hovered 1`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> `
<span class="token operator">&lt;</span>a
  className<span class="token operator">=</span><span class="token string">&quot;normal&quot;</span>
  href<span class="token operator">=</span><span class="token string">&quot;http://www.facebook.com&quot;</span>
  onMouseEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Function bound _onMouseEnter<span class="token punctuation">]</span><span class="token punctuation">}</span>
  onMouseLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Function bound _onMouseLeave<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  Facebook
<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
`<span class="token punctuation">;</span></pre><p>The snapshot artifact should be committed alongside code changes. We use <a href="https://github.com/thejameskyle/pretty-format" target="_blank">pretty-format</a> to make snapshots human-readable during code review. On subsequent test runs Jest will simply compare the rendered output with the previous snapshot. If they match, the test will pass. If they don&#x27;t match, either the implementation has changed and the snapshot needs to be updated with <code>jest -u</code>, or the test runner found a bug in your code that should be fixed.</p><p>If we change the address the Link component in our example is pointing to, Jest will print this output:</p><p><img src="/jest/img/blog/snapshot.png" alt="snapshot-testing"></p><p>Now you know that you either need to accept the changes with <code>jest -u</code>, or fix the component if the changes were unintentional.
To try out this functionality, please clone the <a href="https://github.com/facebook/jest/tree/master/examples/snapshot" target="_blank">snapshot example</a>, modify the Link component and run Jest. We updated the <a href="/jest/docs/tutorial-react.html" target="">React Tutorial</a> with a new guide for snapshot testing.</p><p>This feature was built by <a href="https://twitter.com/soprano" target="_blank">Ben Alpert</a> and <a href="https://twitter.com/kentaromiura" target="_blank">Cristian Carlesso</a>.</p><h2><a class="anchor" name="experimental-react-native-support"></a>Experimental React Native support <a class="hash-link" href="#experimental-react-native-support">#</a></h2><p>By building a test renderer that targets no specific platform we are finally able to support a full, unmocked version of React Native. We are excited to launch experimental React Native support for Jest through the <code>jest-react-native</code> package.</p><p>You can start using Jest with react-native by running <code>npm install jest-react-native —-save-dev</code> and by adding the preset to your Jest configuration:</p><pre class="prism language-javascript">
<span class="token string">&quot;jest&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;preset&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jest-react-native&quot;</span>
<span class="token punctuation">}</span></pre><ul><li><a href="/jest/docs/tutorial-react-native.html#content" target="">Tutorial and setup guide</a></li><li><a href="https://github.com/facebook/jest/tree/master/examples/react-native" target="_blank">Example project</a></li><li><a href="https://github.com/bartonhammond/snowflake/pull/110" target="_blank">Example pull request for <em>snowflake</em></a>, a popular react-native open source library.</li></ul><p><em>Note: the preset currently only implements the minimal set of configuration necessary to get started with React Native testing. We are hoping for community contributions to improve this project. Please try it and file <a href="https://github.com/facebook/jest/issues" target="_blank">issues</a> or send pull requests!</em></p><h2><a class="anchor" name="why-snapshot-testing"></a>Why snapshot testing? <a class="hash-link" href="#why-snapshot-testing">#</a></h2><p>For Facebook&#x27;s native apps we use a system called “snapshot testing”: a snapshot test system that renders UI components, takes a screenshot and subsequently compares a recorded screenshot with changes made by an engineer. If the screenshots don&#x27;t match, there are two possibilities: either the change is unexpected or the screenshot can be updated to the new version of the UI component.</p><p>While this was the solution we wanted for the web, we also found many problems with such end-to-end tests that snapshot integration tests solve:</p><ul><li><strong>No flakiness:</strong> Because tests are run in a command line runner instead of a real browser or on a real phone, the test runner doesn&#x27;t have to wait for builds, spawn browsers, load a page and drive the UI to get a component into the expected state which tends to be flaky and the test results become noisy.</li><li><strong>Fast iteration speed:</strong> Engineers want to get results in less than a second rather than waiting for minutes or even hours. If tests don&#x27;t run quickly like in most end-to-end frameworks, engineers don&#x27;t run them at all or don&#x27;t bother writing them in the first place.</li><li><strong>Debugging:</strong> It&#x27;s easy to step into the code of an integration test in JS instead of trying to recreate the screenshot test scenario and debugging what happened in the visual diff.</li></ul><p>Because we believe snapshot testing can be useful beyond Jest we split the feature into a <a href="https://github.com/facebook/jest/tree/master/packages/jest-snapshot" target="_blank">jest-snapshot</a> package. We are happy to work with the community to make it more generic so it can be integrated with other test runners and share concepts and infrastructure with each other.</p><p>Finally, here is a quote of a Facebook engineer describing how snapshot testing changed his unit testing experience:</p><blockquote><p>“One of the most challenging aspects of my project was keeping the input and output files for each test case in sync. Each little change in functionality could cause all the output files to change. With snapshot testing I do not need the output files, the snapshots are generated for free by Jest! I can simply inspect how Jest updates the snapshots rather than making the changes manually.” – <a href="https://github.com/kyldvs" target="_blank">Kyle Davis</a> working on <a href="https://github.com/kyldvs/fjs" target="_blank">fjs</a>.</p></blockquote><h2><a class="anchor" name="what-s-next-for-jest"></a>What&#x27;s next for Jest <a class="hash-link" href="#what-s-next-for-jest">#</a></h2><p>Recently <a href="https://twitter.com/abramov_dmitrii" target="_blank">Dmitrii Abramov</a> has joined the Jest team full time to improve our unit and integration test infrastructure for Facebook&#x27;s ads products. For the next few months the Jest team is planning major improvements in these areas:</p><ul><li><strong>Replace Jasmine:</strong> Jasmine is slowing us down and is not being very actively developed. We started replacing all the Jasmine matchers and are excited to add new features and drop this dependency.</li><li><strong>Code Coverage:</strong> When Jest was originally created, tools such as babel didn&#x27;t exist. Our code coverage support has a bunch of edge cases and isn&#x27;t always working properly. We are rewriting it to address all the current problems with coverage.</li><li><strong>Developer Experience:</strong> This ranges from improving the setup process, the debugging experience to CLI improvements and more documentation.</li><li><strong>Mocking:</strong> The mocking system, especially around manual mocks, is not working well and is confusing. We hope to make it more strict and easier to understand.</li><li><strong>Performance:</strong> Further performance improvements especially for really large codebases are being worked on.</li></ul><p>As always, if you have questions or if you are excited to help out, please reach out to us!</p></div></div></div></div></div></div><div class="footerContainer"><div class="wrapper footerWrapper"><div class="footerBlocks"><div class="footerSection fbOpenSourceFooter"><svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px"><g><path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z"></path><path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z"></path><path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z"></path></g></svg><h2>Facebook Open Source</h2></div><div class="footerSection"><a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">Open Source Projects</a><a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a><a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a></div><div class="footerSection rightAlign"><a class="footerLink" href="https://github.com/facebook/jest" target="_blank">Contribute on GitHub</a></div></div></div></div></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            docsearch({
              apiKey: '833906d7486e4059359fa58823c4ef56',
              indexName: 'jest',
              inputSelector: '#search_input_react'
            });
          </script></body></html>
